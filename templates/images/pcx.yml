# STATUS: 5% (does not map image data)
# - vs 010: 100%

# - HI: map image data (need FILE_SIZE  and header.length)

# - HI: map image palette (need sample!)

references:
  - https://en.wikipedia.org/wiki/PCX
  - https://www.sweetscape.com/010editor/repository/files/PCX.bt
  - https://github.com/martinlindhe/formats/blob/master/parse/image/img_pcx.go

kind: image
extensions: [.pcx]
mime: image/x-pcx

structs:
  header:
    endian: little
    u8 Signature: 0a
    u8 Version:
      eq 00: PC Paintbrush 2.5 + fixed EGA palette
      eq 02: PC Paintbrush 2.8 + modifiable EGA palette
      eq 03: PC Paintbrush 2.8 + no palette
      eq 04: PC Paintbrush for Windows
      eq 05: PC Paintbrush 3.0, including 24-bit images
      default: invalid
    u8 Encoding:
      eq 00: None
      eq 01: RLE
      default: invalid
    u8 Bits per pixel:
      eq 01: 1bpp (monochrome)
      eq 02: 2bpp (4 colors)
      eq 04: 4bpp (16 colors, EGA)
      eq 08: 8bpp (256 colors, VGA)
      default: invalid
    u16 Minimum X position: ??
    u16 Minimum Y position: ??
    u16 Maximum X position: ??
    u16 Maximum Y position: ??
    u16 Horizontal resolution in DPI: ??
    u16 Vertical resolution in DPI: ??
    u8[48] EGA palette: ??
    u8 Reserved: ??
    u8 Color planes: ??
    u16 Bytes per line: ??
    u16 Palette mode:
      eq 0001: Monochrome or color
      eq 0002: Grayscale
      default: invalid
    u16 Horizontal resolution: ??
    u16 Vertical resolution: ??
    u8[54] Reserved: ??

layout:
  - header Header
  - u8[FILE_SIZE - Header.length] Image data # XXX ignores trailing palette if exists

  # XXX: (optional) 256-color palette (after image data)
  #   If a PCX file has a 256-color palette, it is found 768 bytes from the end of the file. In this case the value in the byte preceding the palette should be 12 (0x0C). The palette is stored as a sequence of RGB triples; its usable length is defined by the number of colors in the image
