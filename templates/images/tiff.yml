# STATUS: 1%
# - HI (magic):if not Signature in["MM","II"]: reject file if signature not MM or II

references:
  - https://en.wikipedia.org/wiki/TIFF
  - https://www.sweetscape.com/010editor/repository/files/TIF.bt
  - https://github.com/HexFiend/HexFiend/blob/master/templates/Images/TIFF.tcl
  - https://github.com/martinlindhe/formats/blob/master/parse/image/img_tiff.go

kind: image
extensions: [.tiff, .tif]
mime: image/tiff

constants:
  u16 BIG_ENDIAN_MAGIC:    c'MM'
  u16 LITTLE_ENDIAN_MAGIC: c'II'

structs:
  header:
    u8[2] Signature: ??       # XXX ascii
    # XXX ENDIANNESS is set by header
    if self.Signature in (BIG_ENDIAN_MAGIC):
      endian: big
    if self.Signature in (LITTLE_ENDIAN_MAGIC):
      endian: little
    #if self.Signature notin (BIG_ENDIAN_MAGIC, LITTLE_ENDIAN_MAGIC):
    #  invalid            # XXX IF SIGNATURE NOT MM or II, its not a valid file

    u16 Arbitrary number: 00 2a # XXX for big endian "00 2a", for little endian "2a 00"

    # XXX rest

layout:
  - header Header
