# STATUS: 10%

# - HI: map image data at end of the file from offsets and length in ICONDIRENTRY


references:
  - https://en.wikipedia.org/wiki/ICO_(file_format)
  - https://github.com/martinlindhe/formats/blob/master/parse/image/img_ico.go
  - https://www.sweetscape.com/010editor/repository/files/ICO.bt

kind: image
extensions: [.ico, .cur]
mime: image/x-icon

structs:
  ICONDIR:
    endian: little
    u16 Reserved: 00 00
    u16 Type:
      eq 0001: Icon
      eq 0002: Cursor
      default: invalid
    u16 Resources: ??             # number of image resources in file

  ICONDIRENTRY:
    u8 Width: ??
    u8 Height: ??
    u8 Palette colors: ??         # 0 = doesn't use palette
    u8 Reserved: ??               # should be 0

    if IconDir.Type.Icon:
      u16 Color planes: ??        # should be 0 or 1
      u16 Bits per pixel: ??
    if IconDir.Type.Cursor:
      u16 Horizontal hotspot: ??
      u16 Vertical hotspot: ??

    u32 Image data size: ??
    u32 Image data offset: ??     # XXX from beginning of file

    # NOTE: offset points to an area after all of the ICONDIRENTRYs

    # XXX could be BMP without header or full PNG
    #u8[Image data offset:Image data offset+Image data size] Image data: ??

layout:
  - ICONDIR IconDir
  - ICONDIRENTRY[IconDir.Resources] Resource
