# STATUS: 60%

# - MID: map "image data" area: BITMAPINFOHEADER and then IMAGEDATA
#   this is an embedded DIB bitmap... OR, an embedded PNG. so able to refer to a separate template might be helpful?
#     - or just allow to tag and extract opaque "PNG" data, and allow processing on the resulting extracted file (XXX could work with a binwalk like clone too to find the PNG header...)

references:
  - https://en.wikipedia.org/wiki/ICO_(file_format)
  - https://www.sweetscape.com/010editor/repository/files/ICO.bt

kind: image
name: Microsoft Windows icon and cursor files
extensions: [.ico, .cur]
mime: image/x-icon
endian: little

structs:
  icon_dir:
    u16 Reserved: 00 00
    u16 Type:
      eq 0001: Icon
      eq 0002: Cursor
      default: invalid
    u16 Resources: ??             # number of image resources in file

  icon_dir_entry:
    u8 Width: ??
    u8 Height: ??
    u8 Palette colors: ??         # 0 = doesn't use palette
    u8 Reserved: ??

    if ICONDIR.Type.Icon:
      u16 Color planes: ??
      u16 Bits per pixel: ??
    if ICONDIR.Type.Cursor:
      u16 Horizontal hotspot: ??
      u16 Vertical hotspot: ??

    u32 Data size: ??
    u32 Data offset: ??

    # XXX the "image data" area contains a DIB header and data or a PNG
    u8[self.Data offset:self.Data size] Image data: ??

layout:
  - icon_dir ICONDIR
  - icon_dir_entry[ICONDIR.Resources] ICONDIRENTRY
