# Android Resource contains app resources such as images, fonts, text or other data types

# STATUS: 5%

# HIGH TODO: ResStringPool_string[self.stringCount] strData: ??          # XXX for this to work, need custom types

references:
  - https://www.sweetscape.com/010editor/repository/files/AndroidResource.bt
  - https://stackoverflow.com/questions/27548810/android-compiled-resources-resources-arsc

tools:
  - aapt (aapt can be found in android-sdk-dir/build-tools/23.0.2/aapt.exe)
  - https://developer.android.com/studio/debug/apk-analyzer

kind: archive
name: Android Resource
extensions: [.arsc, .xml]
endian: little

constants:
  # XXX should not need constants for if-statements
  u16 RES_STRING_POOL_TYPE: 00 01
  u16 RES_TABLE_TYPE:       00 02

types:
  # XXX IMPLEMENT
  ResStringPool_string:
    u8 u16len: ??
    u8 u8len: ??
    asciiz Content: ??

structs:
  chunk:
    u16 Type:
      eq 0000: RES_NULL_TYPE
      eq 0001: RES_STRING_POOL_TYPE
      eq 0002: RES_TABLE_TYPE
      eq 0003: RES_XML_TYPE
      # Chunk types in RES_XML_TYPE
      eq 0100: RES_XML_START_NAMESPACE_TYPE
      eq 0101: RES_XML_END_NAMESPACE_TYPE
      eq 0102: RES_XML_START_ELEMENT_TYPE
      eq 0103: RES_XML_END_ELEMENT_TYPE
      eq 0104: RES_XML_CDATA_TYPE
      eq 017f: RES_XML_LAST_CHUNK_TYPE
      eq 0180: RES_XML_RESOURCE_MAP_TYPE
      # Chunk types in RES_TABLE_TYPE
      eq 0200: RES_TABLE_PACKAGE_TYPE
      eq 0201: RES_TABLE_TYPE_TYPE
      eq 0202: RES_TABLE_TYPE_SPEC_TYPE
      eq 0203: RES_TABLE_LIBRARY_TYPE
      default: invalid
    u16 Header size: ??
    u32 Size: ??

    if self.Type in (RES_TABLE_TYPE):
      label: RES_TABLE
      u32 Package count: ??

    if self.Type in (RES_STRING_POOL_TYPE):
      label: RES_STRING_POOL
      u32 stringCount: ?? # Number of strings in this pool
      u32 styleCount: ?? # Number of style span arrays in the pool
      u32 flags: ??
      u32 stringsStart: ?? # Index from header of the string data
      u32 stylesStart: ?? # Index from header of the style data

      u32[self.stringCount] stringOffsets: ??

      # TODO: ResStringPool_string[self.stringCount] strData: ??          # XXX for this to work, need custom types

layout:
  - chunk[] Chunk
