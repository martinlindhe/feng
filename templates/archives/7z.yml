# STATUS: 1%
# - HI: ArchiveVersion version: ?? # XXX custom struct define!

references:
  - https://en.wikipedia.org/wiki/7z
  - https://github.com/kornelski/7z/blob/master/DOC/7zFormat.txt
  - https://www.sweetscape.com/010editor/repository/files/7ZIP.bt
  - https://github.com/martinlindhe/formats/blob/master/parse/archive/arc_7z.go

kind: archive
extensions: [.7z]
mime: application/x-7z-compressed

endian: little

structs:
  # XXX impl!!!
  ArchiveVersion:      # XXX or standard type "version16" byte 0=major, byte 1=minor
    u8 Major: ??
    u8 Minor: ??

  # XXX impl!!!
  StartHeader:
    u64 NextHeaderOffset: ??
    u64 NextHeaderSize: ??
    u32 NextHeaderCRC: ??

  header:
    # SignatureHeader
    u8[6] Signature: c'7z' bc af 27 1c

    #ArchiveVersion Version: ?? # XXX custom struct define!
    u8 Major version: ?? # XXX max 2021 is 0
    u8 Minor version: ?? # XXX max 2021 is 4

    crc32[NextHeaderOffset.offset:NextHeaderCRC.offset+4] StartHeaderCRC: ??

    # StartHeader Next header: ?? # XXX custom struct define!
    u64 NextHeaderOffset: ??
    u64 NextHeaderSize: ??
    crc32[self.offset+4+NextHeaderOffset.value:self.offset+4+NextHeaderOffset.value+NextHeaderSize.value] NextHeaderCRC: ??

    #XXX seek to NextHeaderOffset
    # [PackedStreams]

    # [PackedStreamsForHeaders]
    # XXX

layout:
  - header Header
