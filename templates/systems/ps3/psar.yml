# STATUS: 5%

# Used in:
# God of War III (PS3)
# No Man's Sky (PC)

# TODO MAX: finish converting http://aluigi.org/bms/brink.bms

# TODO: "PSAR" archive is used in various ps3 games: https://forum.xentax.com/viewtopic.php?p=91717#p91717

references:
  - https://www.psdevwiki.com/ps3/PlayStation_archive_(PSARC)
  - https://forum.xentax.com/viewtopic.php?t=14846
  - http://aluigi.org/bms/brink.bms # XXX
  - https://forum.xentax.com/viewtopic.php?p=91717#p91717 # PS3 format, similar/same ???

software:
  - paru -S psarc  # arch linux
  - http://nomansskymods.com/mods/psarc-decompile-tool/

kind: game
name: No Man's Sky PSAR archive
extensions: [.pak, .psarc]
endian: big

magic:
  - offset: 0000
    match: c'PSAR'

structs:
  header:
    ascii[4] Signature: c'PSAR'
    u16 MajorVersion: ??    # 1
    u16 MinorVersion: ??    # 4
    ascii[4] CompressionFormat: ??        # "zlib". XXX also "lzma" is valid, NEED SAMPLE.
    u32 HeaderSize: ??
    u32 EntrySize: ??
    u32 EntryCount: ??
    u32 DataBlockSize: ??
    u32 Flags:
      bit b00000000_00000000_00000000_00000001: Relative paths
      bit b00000000_00000000_00000000_00000010: Ignorecase paths
      bit b00000000_00000000_00000000_00000100: Absolute paths
      bit b11111111_11111111_11111111_11111000: Reserved

layout:
  - header Header
